<%= render "shared/form_messages", :object => @agent %>

<fieldset>
  <section id="agent_details">
    <h3>Agent Details</h3>
    <%# f.label_field_pair :type %>
    <div class="control-group">
       <label class="control-label">Type</label>
       <div class="controls label-only">
          <%= f.hidden_field :agent_type %>
          <strong><%= I18n.t("agent.#{@agent.agent_type}") %></strong>
       </div>
    </div>
    <div class="control-group">
       <label class="control-label">Something</label>
       <div class="controls label-only">
          Goes here
       </div>
    </div>
    <div class="control-group">
       <label class="control-label">Something</label>
       <div class="controls label-only">
          Else
       </div>
    </div>
  </section>

  <section id="primary_name">
    <h3>Primary Name</h3>
    <%= f.fields_for "names", @agent.names[0] do | name_fields | %>
      <%= render :partial => "agents/name_forms/#{@agent.agent_type}", :locals => {:f => name_fields} %>
    <% end %>
  </section>

  <section id="secondary_names">
    <h3>
      Secondary Name(s)
      <input type="button" class="btn btn-small pull-right" value="Add Secondary Name"/>
    </h3>
    <div id="secondary_names_container">
      <% if @agent.names.length > 1 %>
        <% @agent.names.each_with_index do | name , index | %>
          <% if index > 0 %>
            <%= f.fields_for "names", name, :child_index => "${index}" do | name_fields | %>
              <%= render :partial => "agents/name_forms/secondary_name_form", :locals => {:f => name_fields, :agent_type => @agent.agent_type} %>
            <% end %>
          <% end %>
        <% end %>
      <% else %>
        <p class="alert alert-info">Click 'Add Secondary Name' to add further name records.</p>
      <% end %>
    </div>
  </section>

  <section id="contacts">
    <h3>
      Contact Details
      <input type="button" class="btn btn-small pull-right" value="Add Contact Details"/>
    </h3>
    <div id="contacts_container">
      <p class="alert alert-info">Click 'Add Contact Details' to add contact detail records.</p>
    </div>
  </section>

  <section id="relationships">
    <h3>Relationships</h3>
    <p class="alert alert-info">TODO</p>
  </section>

</fieldset>

<div id="agent_contact_form_template"><!--
  <%= f.fields_for "contacts", JSONModel(:agent_contact).new._always_valid!, :child_index => "${index}" do | contact_fields | %>
    <%= render :partial => "agents/contact_details", :locals => {:f => contact_fields} %>
  <% end %>
--></div>

<div id="agent_secondary_name_form_template"><!--
  <%= f.fields_for "names", JSONModel(:name_person).new._always_valid!, :child_index => "${index}" do | name_fields | %>
    <%= render :partial => "agents/name_forms/secondary_name_form", :locals => {:f => name_fields, :agent_type => @agent.agent_type} %>
  <% end %>
--></div>